<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Workflow (1.0) &mdash; MetaReForge Docs 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css?v=7dc6ce7e" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=f2a433a1"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Workflow (1.1-beta)" href="workflow_1_1.html" />
    <link rel="prev" title="Installation Guide" href="installation_guide.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            MetaReForge Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation_guide.html">Installation Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Workflow (1.0)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#preliminary-setup">Preliminary Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#scene-setup">Scene Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#importing-fbx">1. Importing FBX</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-edit-mesh-edit-armature-and-other-auxiliary-objects">2. Creating Edit Mesh, Edit Armature, and Other Auxiliary Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="#editing-the-mesh">3. Editing the Mesh</a></li>
<li class="toctree-l2"><a class="reference internal" href="#editing-the-armature">4. Editing the Armature</a></li>
<li class="toctree-l2"><a class="reference internal" href="#applying-changes-to-exportable-objects">5. Applying Changes to Exportable Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="#quality-check-and-re-computing-normals">6. Quality Check and Re-Computing Normals</a></li>
<li class="toctree-l2"><a class="reference internal" href="#export-fbx">7. Export FBX</a></li>
<li class="toctree-l2"><a class="reference internal" href="#update-dna">8. Update DNA</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="workflow_1_1.html">Workflow (1.1-beta)</a></li>
<li class="toctree-l1"><a class="reference internal" href="unreal_engine.html">Reimport Metahuman in Unreal Engine</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MetaReForge Docs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Workflow (1.0)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/workflow_1_0.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="workflow-1-0">
<h1>Workflow (1.0)<a class="headerlink" href="#workflow-1-0" title="Link to this heading"></a></h1>
<p>We’ve designed MetaReForge addon interface to be as clear and structured as possible.  All features are organized into blocks within the N-panel under the ‘MRF’ category. The majority of these features are accessible in object mode, while additional utilities for armature editing become available in armature edit mode.
Check out out <a class="reference external" href="https://youtu.be/32PLLmDs9wE">workflow tutorial</a> on youtube</p>
<section id="preliminary-setup">
<h2>Preliminary Setup<a class="headerlink" href="#preliminary-setup" title="Link to this heading"></a></h2>
<p>First, we need to prepare the files for editing. You will need:</p>
<ol>
<li><p>The head’s FBX file</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Content/Metahumans/&lt;METAHUMAN_NAME&gt;/Face/&lt;METAHUMAN_NAME&gt;_FaceMesh</span></code></p></li>
<li><p>right-click on the corresponding skeletal mesh in the content browser Asset Actions - Export as FBX).</p></li>
<li><p>Convert FBX with <a class="reference external" href="https://aps.autodesk.com/developer/overview/fbx-converter-archives">Autodesk FBX 2013 Converter</a> (do not ignore this step cause otherwise some data as for example shape keys will be lost!!)</p></li>
</ul>
<a href="./images/export_as_fbx.png">
   <p align="center">
      <img src="./images/export_as_fbx.png" width="50%" height="50%"/>
   </p>
</a></li>
<li><p>The body’s FBX file exported in the same way as the head, preferably use a body skeletal mesh  that includs all polygons, without any deleted polygons under the clothing.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Content/Metahumans/&lt;NAME&gt;/&lt;SEX&gt;/&lt;HEIGHT&gt;/&lt;WEIGHT&gt;/Body/&lt;BODY_SKELETAL_MESH&gt;</span></code></p></li>
</ul>
</li>
<li><p>The DNA file. It’s usually found in the Quixel Bridge asset folder. By default, look in</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">C:\Users\&lt;USER_NAME&gt;\Documents\Megascans</span> <span class="pre">Library\Downloaded\UAssets\&lt;ASSET_ID&gt;\Tier0\asset_ue\MetaHumans\&lt;METAHUMAN_NAME&gt;\SourceAssets</span></code>).</p></li>
</ul>
<a href="./images/get_original_dna.png">
   <p align="center">
      <img src="./images/get_original_dna.png" width="50%" height="50%"/>
   </p>
</a></li>
</ol>
</section>
<section id="scene-setup">
<h2>Scene Setup<a class="headerlink" href="#scene-setup" title="Link to this heading"></a></h2>
<p>The first thing to do when opening a new scene in Blender is to set the units of measurement (this is necessary to match the units in Unreal Engine). The metric system should be selected with a Unit Scale = 0.01. If the units are not set up, the addon panel will display a <strong>Setup Scene</strong> button, which will configure the units as mentioned earlier.</p>
</section>
<section id="importing-fbx">
<h2>1. Importing FBX<a class="headerlink" href="#importing-fbx" title="Link to this heading"></a></h2>
<p>To import files, use the <strong>“FBX Import”</strong> block on the N-panel of the addon (Object mode). Specify which body parts you want to import (head, body, or both), indicate the path to the corresponding files, and click <strong>“Import FBX”</strong>.</p>
<p><strong>Note.</strong> It’s not recommended to import FBX files in any other way. The addon removes unnecessary elements, analyzes LODs, and assigns them to the corresponding internal properties (which can be viewed by expanding the “Head Objects” and “Body Objects” drop-down lists). This can’t be done manually.</p>
</section>
<section id="creating-edit-mesh-edit-armature-and-other-auxiliary-objects">
<h2>2. Creating Edit Mesh, Edit Armature, and Other Auxiliary Objects<a class="headerlink" href="#creating-edit-mesh-edit-armature-and-other-auxiliary-objects" title="Link to this heading"></a></h2>
<p>Once the FBX files are imported, we can proceed to initialize auxiliary and editable objects. For this, we move to the <strong>“Edit Shape”</strong> block.</p>
<p>To ensure clarity, let’s review the terminology used in the addon:</p>
<ul class="simple">
<li><p><strong>Final Mesh:</strong> A mesh tailored for editing. When editing the entire body, the head and body are joined, and all seams are welded.</p></li>
<li><p><strong>Final Armature:</strong> An armature created for editing. If the entire body is edited, the head and body skeletons are merged into one, removing all duplicates.</p></li>
</ul>
<p>No additional setup is generally required, but two parameters are available:</p>
<ul class="simple">
<li><p><strong>Weld Distance:</strong> Determines the distance (centimeters) at which the vertices of the meshes will be welded.</p></li>
<li><p><strong>Keep ShapeKeys:</strong> By default, this is turned off to avoid storing shape key data for auxiliary objects and to keep the blend file size manageable.</p></li>
</ul>
</section>
<section id="editing-the-mesh">
<h2>3. Editing the Mesh<a class="headerlink" href="#editing-the-mesh" title="Link to this heading"></a></h2>
<p>Once the auxiliary objects are initialized, you can start editing the mesh. Blender offers a wide range of editing capabilities, but if you need more, you can export the Final Mesh and edit it in an external editor.</p>
<p><strong>It’s crucial to remember:</strong></p>
<ul class="simple">
<li><p>The topology and vertex indexing must remain UNCHANGED.</p></li>
<li><p>If the mesh was edited in an external editor, you need to assign the edited mesh to the Final Shape - Mesh field.</p></li>
</ul>
</section>
<section id="editing-the-armature">
<h2>4. Editing the Armature<a class="headerlink" href="#editing-the-armature" title="Link to this heading"></a></h2>
<p>After achieving the desired mesh shape, it’s necessary to adjust the skeleton to these changes. The Metahuman skeleton contains about a thousand bones, and editing it manually is tedious and time-consuming. Therefore, our addon includes tools to simplify this routine by transferring the deformation from the final mesh to the skeleton.</p>
<p>To start editing the skeleton, you need to select it and switch to edit mode. If everything is done correctly, you will see the necessary tools in the MRF section on the N-panel.
All tools transfer the deformation of the final mesh only to the selected bones, allowing for better control of the process.</p>
<ul class="simple">
<li><p><strong>Surface Deform</strong>: As the name suggests, this method is based on binding bones to surfaces, making it very effective for bones close to the mesh surface. It’s less effective for bones deep inside the mesh, but since most Metahuman bones are near the surface, it’s recommended to start with this method.</p></li>
<li><p><strong>Mesh Deform:</strong> This option is based on the Mesh Deform modifier and works well for bones deep within the mesh. For some bones that are even a fraction of a millimeter outside the mesh or near seams or openings, this algorithm won’t work at all.</p></li>
</ul>
<p>To use the methods mentioned, it’s necessary to initialize a proxy for each method <strong>just once</strong>. Use <strong>“Init Proxy”</strong> button. Even if changes are made to the Final Mesh, re-initialization is not required. <strong>The proxy is initialized for all bones at once</strong>. For Mesh Deform, the proxy initialization can take a significant amount of time, especially if the precision is set to 5 or higher (recommended values are 4 or 5).</p>
<p>After initialization, you can select the desired bones and transfer the deformation by clicking <strong>“Fit Selected.”</strong></p>
<p>Particular attention should be paid to:</p>
<ul class="simple">
<li><p>The bones responsible for eye rotation, unless you want the eyes to pop out when looking sideways. :)</p></li>
<li><p>The lip bones. In areas where the polygons of the lower and upper lips are very close or even intersect, the above methods may not yield the desired result. Therefore, manual editing may be required.</p></li>
</ul>
</section>
<section id="applying-changes-to-exportable-objects">
<h2>5. Applying Changes to Exportable Objects<a class="headerlink" href="#applying-changes-to-exportable-objects" title="Link to this heading"></a></h2>
<p>When the creative part of the work is completed, it’s necessary to transfer all changes to the exportable models. For this, we go to the <strong>“Update Original”</strong> block. By clicking on the <strong>“Synchronize”</strong> button, changes from the Final Mesh (more precisely, the difference between the Final Mesh and the Initial Mesh) will be applied to the individual LODs, and the updated position of the bones will also be applied to the original armature objects.</p>
<p>No additional tuning is generally required, but a few parameters are available for dealing with exceptional cases:</p>
<ul class="simple">
<li><p><strong>Use Noise:</strong> Default is True. It introduces a small amount of noise to the vertex positions at the time of binding. The Surface Deform modifier, which this operator is based on, fails to work if the vertex positions are identical. The noise value is usually extremely small, making its visual impact imperceptible, but it’s sufficient for the Surface Deform algorithm to bind successfully.</p></li>
<li><p><strong>Min, Max:</strong> The minimum and maximum values of the noise in centimeters. These should only be increased if synchronization fails with standard settings. However, I recommend trying to press <strong>Synchronize</strong> again or several times in case of failure. Due to the random nature of the process, there’s a good chance of achieving a noise configuration that allows smooth synchronization even without changing parameters.</p></li>
</ul>
</section>
<section id="quality-check-and-re-computing-normals">
<h2>6. Quality Check and Re-Computing Normals<a class="headerlink" href="#quality-check-and-re-computing-normals" title="Link to this heading"></a></h2>
<p>After applying the changes, you can review the results. For convenience, there is a <strong>“View”</strong> block at the top of the panel, where you can switch between LODs and editable objects. There may be minor imperfections, which can be corrected manually.</p>
<p>It’s important to pay attention to the seam between the head and body and also to the seams along the UV unwrap, as Metahuman actually has mesh splits at the UV seams. If sharp edges are noticeable, normals need to be recalculated, and we have developed a specific function for this.</p>
<p>After clicking on <strong>“Re-Compute Split Normals”</strong>, the following will occur:</p>
<ol class="simple">
<li><p>If Align Vertices is enabled, all points that are closer than the Weld Distance will be merged into one position.</p></li>
<li><p>Normals will be recalculated as if all seams are welded.</p></li>
</ol>
<p>With <strong>Weld Distance</strong> (in centimeters), you can control this process, but the default value is chosen to work in most cases. With a Weld Distance of more than 0.01, you might start to see points welding together that shouldn’t be.</p>
<p><strong>Remember</strong>, excessive Weld Distance can result in unintended merging of points, so it should be used cautiously.</p>
</section>
<section id="export-fbx">
<h2>7. Export FBX<a class="headerlink" href="#export-fbx" title="Link to this heading"></a></h2>
<p>Once all LODs look as desired, it’s time to export them for use in Unreal Engine. Based on my experience, I prefer to export LODs separately because this way, you don’t have to spend a lot of time configuring Material Slots in Unreal Engine. Following this logic, we have a utility for exporting. You just need to specify the path and click <strong>“Export FBX”</strong>. There’s no need to worry about settings, selecting the right objects, etc. Everything will be done for you. As a result, you should see 8 LODs for the head and 4 LODs for the body in the folder, so you can upload these files to Unreal Engine.</p>
</section>
<section id="update-dna">
<h2>8. Update DNA<a class="headerlink" href="#update-dna" title="Link to this heading"></a></h2>
<p>The Metahuman Animation blueprint heavily relies on the DNA file. Therefore, if you want your custom Metahuman to retain the ability to perform realistic facial animations, updating the DNA file is an ESSENTIAL step.
Note: If you don’t see the necessary functionality in the <strong>“DNA Update”</strong> block, check the Installation Guide.</p>
<p>All you need to do is:</p>
<ul class="simple">
<li><p>Specify the path to the original DNA file.</p></li>
<li><p>Specify the path for saving the updated file.</p></li>
<li><p>Click <strong>“Armature to DNA”</strong>. MetaReForge will record the actual positions of the bones from Blender into the DNA file (Neutral Joint Translations and Rotations, following Epic Games’ terminology).</p></li>
<li><p>To assign the updated DNA file to a Metahuman in Unreal Engine, you need to drag and drop it into the Content Browser and select the relevant Skeletal Mesh.</p></li>
</ul>
<p>For troubleshooting, check out to our <a class="reference external" href="https://discord.gg/qYtEq2ukDX">Discord Server</a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation_guide.html" class="btn btn-neutral float-left" title="Installation Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="workflow_1_1.html" class="btn btn-neutral float-right" title="Workflow (1.1-beta)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Sqeezy Pixels (Mykyta Petrenko).</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>